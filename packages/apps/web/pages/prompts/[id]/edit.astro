---
import Layout from '../../../layouts/Layout.astro';
import PromptEditor from '../../../components/PromptEditor.astro';

const { id } = Astro.params;

if (!id) {
  return Astro.redirect('/prompts');
}

// Fetch the prompt data
let prompt = null;
let error = null;

try {
  const response = await fetch(`${Astro.url.origin}/api/prompts/${id}`);
  if (response.ok) {
    prompt = await response.json();
  } else if (response.status === 404) {
    error = 'Prompt not found';
  } else {
    error = 'Failed to load prompt';
  }
} catch (err) {
  console.error('Error fetching prompt:', err);
  error = 'Failed to load prompt';
}

if (error) {
  return Astro.redirect('/prompts?error=' + encodeURIComponent(error));
}
---

<Layout title={`Edit ${prompt?.name || 'Prompt'} - Prompt Craft`}>
  <div class="mb-6">
    <div class="flex items-center space-x-4 text-sm text-gray-600">
      <a href="/prompts" class="hover:text-primary-600 transition-colors">
        ‚Üê Back to Prompts
      </a>
      <span>/</span>
      <a href={`/prompts/${prompt.id}`} class="hover:text-primary-600 transition-colors">
        {prompt.name}
      </a>
      <span>/</span>
      <span class="text-gray-900 font-medium">Edit</span>
    </div>
  </div>
  
  <PromptEditor prompt={prompt} isEdit={true} />
</Layout>